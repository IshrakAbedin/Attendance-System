-- A demo user account DEMOTEACHER for demonstration purpose
CREATE USER DEMOTEACHER IDENTIFIED BY DEMOPASSWORD;
-- Access to DEMOTEACHER
GRANT CONNECT, RESOURCE, CREATE SESSION, DBA TO DEMOTEACHER;

-- After creating the account, log out from system or dba account and sign in as DEMOTEACHER
-- Create the following tables/views after that

-- An arbitrary table representing collection of class and section info per teacher
-- In ideal case, it should be kept under admin only and only the corresponding view mentioned later should be accessible by a teacher
-- Also all the atributes in the table should be foreign keys from different tables since it is a junction table
-- It is done in this way for simplification of protyping since the actual implementation of database is still unknown
CREATE TABLE DEMOCLASSHUB(
    TID NUMBER,
    TNAME VARCHAR2(25),
    SECTION VARCHAR2(15),
    CLASS VARCHAR2(15),
    CONSTRAINT PK_DEMOCLASSHUB PRIMARY KEY (TID, SECTION, CLASS)
);

-- An arbitrary table representing section DEMOSECTION
-- A section holds the information about student ID, name, address and contact number
CREATE TABLE DEMOSECTION(
    SID NUMBER,
    NAME VARCHAR2(25),
    ADDRESS VARCHAR2(30),
    CONTACT_NUMBER VARCHAR2(14),
    CONSTRAINT PK_DEMOSECTION PRIMARY KEY (SID)
);

-- An arbitrary table representing class DEMOCLASS
-- Each class table can represent one specific subject class taken by a teacher
-- Holds student ID and DAY representing each academic day where class has been taken and students were present
-- It is an arbitrary linking table
CREATE TABLE DEMOCLASS(
    SID NUMBER,
    DAY VARCHAR2(6),
    CONSTRAINT PK_DEMOCLASS PRIMARY KEY (SID, DAY),
    CONSTRAINT FK_DEMOCLASS FOREIGN KEY (SID) REFERENCES DEMOSECTION (SID)
);

-- Arbitrary value insertion into DEMOSECTION for test purpose
INSERT INTO DEMOSECTION VALUES (101, 'STUDENT 1', 'ADDRESS 1', 'CONTACT 1');
INSERT INTO DEMOSECTION VALUES (102, 'STUDENT 2', 'ADDRESS 2', 'CONTACT 2');
INSERT INTO DEMOSECTION VALUES (103, 'STUDENT 3', 'ADDRESS 3', 'CONTACT 3');
INSERT INTO DEMOSECTION VALUES (104, 'STUDENT 4', 'ADDRESS 4', 'CONTACT 4');
INSERT INTO DEMOSECTION VALUES (105, 'STUDENT 5', 'ADDRESS 5', 'CONTACT 5');

-- Arbitrary value insertion into DEMOCLASS for test purpose
INSERT INTO DEMOCLASS VALUES (101, 'SEP22');
INSERT INTO DEMOCLASS VALUES (102, 'SEP22');
INSERT INTO DEMOCLASS VALUES (103, 'SEP22');
INSERT INTO DEMOCLASS VALUES (104, 'SEP22');
INSERT INTO DEMOCLASS VALUES (101, 'SEP23');
INSERT INTO DEMOCLASS VALUES (103, 'SEP23');
INSERT INTO DEMOCLASS VALUES (104, 'SEP23');
INSERT INTO DEMOCLASS VALUES (101, 'SEP24');
INSERT INTO DEMOCLASS VALUES (102, 'SEP24');
INSERT INTO DEMOCLASS VALUES (103, 'SEP24');
INSERT INTO DEMOCLASS VALUES (104, 'SEP24');
INSERT INTO DEMOCLASS VALUES (105, 'SEP24');

-- Arbitrary value insertion into DEMOCLASS for test purpose
INSERT INTO DEMOCLASSHUB VALUES (11, 'DEMOTEACHER', 'DEMOSECTION', 'DEMOCLASS');
INSERT INTO DEMOCLASSHUB VALUES (11, 'DEMOTEACHER', 'CSE16', 'CSE9406');
INSERT INTO DEMOCLASSHUB VALUES (11, 'DEMOTEACHER', 'CSE17', 'CSE8321');
INSERT INTO DEMOCLASSHUB VALUES (12, 'MRX', 'SWE13', 'MAT1112');
INSERT INTO DEMOCLASSHUB VALUES (12, 'MRX', 'MCE99', 'MCE2283');
INSERT INTO DEMOCLASSHUB VALUES (13, 'MRY', 'EEE55', 'EEE4848');

-- A View:DEMOTEACHER_COURSES returning sections and classes available to demoteacher
CREATE OR REPLACE VIEW DEMOTEACHER_COURSES AS
SELECT SECTION, CLASS FROM DEMOCLASSHUB
WHERE TNAME = 'DEMOTEACHER'
ORDER BY SECTION ASC;
-- SELECT * FROM DEMOTEACHER_COURSES;

-- A View:DEMOSECTION_STUDENT_COUNT returning total student count of section
CREATE OR REPLACE VIEW DEMOSECTION_STUDENT_COUNT AS
SELECT COUNT(SID) STUDENT_COUNT FROM DEMOSECTION;
-- SELECT * FROM DEMOSECTION_STUDENT_COUNT;

-- A View:DEMOCLASS_ATTENDANCE_COUNT returning attendance count for every student based on student ID
CREATE OR REPLACE VIEW DEMOCLASS_ATTENDANCE_COUNT AS
SELECT CLASS.SID, COUNT(CLASS.DAY) ATTENDANCE_COUNT
FROM DEMOCLASS CLASS
GROUP BY CLASS.SID;
-- SELECT * FROM DEMOCLASS_ATTENDANCE_COUNT;

-- A View:DEMOCLASS_TOTAL_CLASS_COUNT returning total academic days of class
CREATE OR REPLACE VIEW DEMOCLASS_TOTAL_CLASS_COUNT AS
SELECT COUNT(UNIQUE DAY) TOTAL_CLASS_COUNT
FROM DEMOCLASS;
-- SELECT * FROM DEMOCLASS_TOTAL_CLASS_COUNT;

-- A View:DEMOCLASS_PERCENTAGE returning attendance percentage for every student based on student ID
CREATE OR REPLACE VIEW DEMOCLASS_PERCENTAGE AS
SELECT ATTENDANCE.SID, (ATTENDANCE.ATTENDANCE_COUNT / (SELECT TOTAL_CLASS_COUNT FROM DEMOCLASS_TOTAL_CLASS_COUNT)) * 100 ATTENDANCE_PERCENTAGE
FROM DEMOCLASS_ATTENDANCE_COUNT ATTENDANCE;
--SELECT * FROM DEMOCLASS_PERCENTAGE;

-- A View:DEMOCLASS_DEFAULTERS returning the student IDs and attendance percentage for those students who has attendance below 75%
CREATE OR REPLACE VIEW DEMOCLASS_DEFAULTERS AS
SELECT * FROM DEMOCLASS_PERCENTAGE
WHERE ATTENDANCE_PERCENTAGE < 75
ORDER BY SID ASC;
--SELECT * FROM DEMOCLASS_DEFAULTERS;

-- A View:DEMOCLASS_DEFAULTERS_COUNT returning total defaulter count of the class
CREATE OR REPLACE VIEW DEMOCLASS_DEFAULTERS_COUNT AS
SELECT COUNT(SID) DEFAULTER_COUNT
FROM DEMOCLASS_DEFAULTERS;
--SELECT * FROM DEMOCLASS_DEFAULTERS_COUNT;

-- A View:DEMOCLASS_PERCENTAGE_W_NAME returning attendance percentage for every student based on student ID with name
CREATE OR REPLACE VIEW DEMOCLASS_PERCENTAGE_W_NAME AS
SELECT DEFAULTERS.SID, SECTION.NAME, DEFAULTERS.ATTENDANCE_PERCENTAGE
FROM DEMOSECTION SECTION, DEMOCLASS_PERCENTAGE DEFAULTERS
WHERE DEFAULTERS.SID = SECTION.SID
ORDER BY DEFAULTERS.SID ASC;
--SELECT * FROM DEMOCLASS_PERCENTAGE_W_NAME;

-- A View:DEMOCLASS_DEFAULTERS_W_NAME returning the student IDs, names and attendance percentage for those students who has attendance below 75%
CREATE OR REPLACE VIEW DEMOCLASS_DEFAULTERS_W_NAME AS
SELECT DEFAULTERS.SID, SECTION.NAME, DEFAULTERS.ATTENDANCE_PERCENTAGE
FROM DEMOSECTION SECTION, DEMOCLASS_DEFAULTERS DEFAULTERS
WHERE DEFAULTERS.SID = SECTION.SID
ORDER BY DEFAULTERS.SID ASC;
--SELECT * FROM DEMOCLASS_DEFAULTERS_W_NAME;

-- A View:DEMOCLASS_EXTENDED_ATTENDANCE returning the student ID, name, address, contact number, attendance count and attendance percentage for all students of the section
CREATE OR REPLACE VIEW DEMOCLASS_EXTENDED_ATTENDANCE AS
SELECT SECTION.SID, SECTION.NAME, SECTION.ADDRESS, SECTION.CONTACT_NUMBER, ACOUNT.ATTENDANCE_COUNT, APERCENTAGE.ATTENDANCE_PERCENTAGE
FROM DEMOSECTION SECTION, DEMOCLASS_ATTENDANCE_COUNT ACOUNT, DEMOCLASS_PERCENTAGE APERCENTAGE
WHERE SECTION.SID = ACOUNT.SID AND SECTION.SID = APERCENTAGE.SID
ORDER BY SECTION.SID ASC;
--SELECT * FROM DEMOCLASS_EXTENDED_ATTENDANCE;

-- A View:DEMOCLASS_TAKENDAYS returning the days when classes have been taken
CREATE OR REPLACE VIEW DEMOCLASS_TAKENDAYS AS 
SELECT UNIQUE DAY FROM DEMOCLASS;
--SELECT * FROM DEMOCLASS_TAKENDAYS;

/*
SELECT * FROM DEMOCLASS
WHERE DAY = 'SEP24';*/

/*
DELETE FROM DEMOCLASS
WHERE SID = 101 AND DAY = 'SEP25';*/
